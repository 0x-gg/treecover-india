<!doctype html>
<!--[if lt IE 7]>      <html class="no-js lt-ie9 lt-ie8 lt-ie7" lang=""> <![endif]-->
<!--[if IE 7]>         <html class="no-js lt-ie9 lt-ie8" lang=""> <![endif]-->
<!--[if IE 8]>         <html class="no-js lt-ie9" lang=""> <![endif]-->
<!--[if gt IE 8]><!-->
<html class="no-js" lang="">
<!--<![endif]-->

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <title></title>
    <meta name="description" content="">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="apple-touch-icon" href="apple-touch-icon.png">
    <link rel="stylesheet" href="css/normalize.min.css">
    <link rel="stylesheet" href="css/main.css">
    <script src="js/vendor/modernizr-2.8.3-respond-1.4.2.min.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
</head>

<body>
    <!--[if lt IE 8]>
            <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> to improve your experience.</p>
        <![endif]-->
    <div class="body">
        <div class="header">
            <div class="ht">Tree Cover in India</div>
            <div class="prompt">(Responsive, but better viewed on desktop on a modern browser)</div>
        </div>
        <br>
        <div class="mainpage">
            <div class="left">
                <p>Thanks for coming by! The raw data for this visualization is taken from the Government of India Open Government Data (OGD) <a href="https://data.gov.in/catalog/stateut-wise-tree-cover-estimates">website</a>. The tree cover is estimated bi-annually and hence you see data from 2009, 2011 and 2013. There is no data after 2013. You can click the buttons below to see the statewise area under tree cover. The numbers beneath the state or union territory short name indicate the area in sq. km.</p>
                <p>I used a bunch of tools and techniques to make this viz. CSS flexbox, GeoJSON parsers, online color palettes etc. (did you spot that pun?) and I will be blogging soon about the process I followed. It was an amazing learning experience for me! In future, this could possibly have a gradient map and percentage values. I hope to take on some increasingly complex data visualizations in the future!</p>
                <div class="buttons">
                    <div data-year="2009" class="button">Year 2009</div>
                    <div data-year="2011" class="button">Year 2011</div>
                    <div data-year="2013" class="button">Year 2013</div>
                </div>
            </div>
            <div class="map"></div>
        </div>
    </div>
    <script src="https://d3js.org/d3.v4.min.js"></script>
    <script src="https://d3js.org/topojson.v1.min.js"></script>
    <script type="text/javascript">
    var treeCover;

    $.getJSON('tree-cover.json', function(response) {
        treeCover = response;
    })

    var w = Math.max(document.documentElement.clientWidth, window.innerWidth || 0);
    console.log(w);
    var width, height, scale, long, lat;
    if (w >= 500) {
        width = 880,
            height = width / 800 * 950;
        scale = 1650;
        long = 83.5;
        lat = 30;
        rad = 1.15;
        stateFont = "1rem";
        capFont = "0.8rem";
        spacing = 12;
    } else {
        width = w,
            height = width / 800 * 950;
        scale = 650;
        long = 109;
        lat = 19;
        rad = 2.5;
        stateFont = "0.7rem";
        capFont = "0.55rem";
        spacing = 7;
    }


    var projection = d3.geoMercator()
        .scale(scale)
        .center([long, lat]);

    var path = d3.geoPath()
        .projection(projection);

    svg = d3.select(".map").append("svg")
        .attr("width", width)
        .attr("height", height);

    d3.json("ind-topo.json", function(error, india) {
        if (error) return console.error(error);

        var states = topojson.feature(india, india.objects.states);

        svg.append("path")
            .datum(topojson.feature(india, india.objects.states))
            .attr("d", path)
            .attr("class", "state-borders");

        svg.selectAll(".states")
            .data(states.features)
            .enter().append("path")
            .attr("class", function(d) {
                return "states " + d.properties.HASC_1;
            })
            .attr("d", path);
    });

    function drawMap(e) {

        mapYear = e.target.getAttribute("data-year");

        if (svg) svg.remove();

        svg = d3.select(".map").append("svg")
            .attr("width", width)
            .attr("height", height);

        d3.json("ind-topo.json", function(error, india) {
            if (error) return console.error(error);

            var states = topojson.feature(india, india.objects.states);

            svg.append("path")
                .datum(topojson.feature(india, india.objects.states))
                .attr("d", path)
                .attr("class", "state-borders");

            svg.selectAll(".states")
                .data(states.features)
                .enter().append("path")
                .attr("class", function(d) {
                    return "states " + d.properties.HASC_1;
                })
                .attr("d", path);
            // console.log(states);
            var centroids = states.features.map(function(feature) {
                var coordinates = path.centroid(feature);
                var mapJSON = eval(`treeCover.india${mapYear}`);
                var radius = Math.sqrt(mapJSON[feature.properties.HASC_1] / Math.PI) / rad;
                svg.append("circle")
                    .attr("cx", coordinates[0])
                    .attr("cy", coordinates[1])
                    .attr("r", radius)
                    .attr("class", "circles");
                stateAbbr = feature.properties.HASC_1;
                svg.append("text")
                    .attr("x", coordinates[0] - radius * 0.4)
                    .attr("y", coordinates[1])
                    .text(stateAbbr)
                    .attr("font-size", stateFont)
                    .attr("fill", "black");
                treeArea = mapJSON[feature.properties.HASC_1];
                svg.append("text")
                    .attr("x", coordinates[0] - radius * 0.4)
                    .attr("y", coordinates[1] + spacing)
                    .text(treeArea)
                    .attr("font-size", capFont)
                    .attr("fill", "black");
            });


        });
    }

    const buttons = document.querySelectorAll('.button');
    // buttons.forEach(button => button.addEventListener('mouseenter', drawMap));
    buttons.forEach(button => button.addEventListener('click', drawMap));
    </script>
    <script src="//ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
    <script>
    window.jQuery || document.write('<script src="js/vendor/jquery-1.11.2.min.js"><\/script>')
    </script>
    <script src="js/main.js"></script>
    <!-- Google Analytics: change UA-XXXXX-X to be your site's ID. -->
    <!--         <script>
            (function(b,o,i,l,e,r){b.GoogleAnalyticsObject=l;b[l]||(b[l]=
            function(){(b[l].q=b[l].q||[]).push(arguments)});b[l].l=+new Date;
            e=o.createElement(i);r=o.getElementsByTagName(i)[0];
            e.src='//www.google-analytics.com/analytics.js';
            r.parentNode.insertBefore(e,r)}(window,document,'script','ga'));
            ga('create','UA-XXXXX-X','auto');ga('send','pageview');
        </script> -->
    <script id="__bs_script__">
    //<![CDATA[
    document.write("<script async src='http://HOST:3000/browser-sync/browser-sync-client.js?v=2.18.5'><\/script>".replace("HOST", location.hostname));
    //]]>
    </script>
</body>

</html>
